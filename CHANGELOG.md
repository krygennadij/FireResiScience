# История изменений FireResiScience

## [1.0.0] - 2026-01-08

### Исправлено (Критические ошибки)

#### 1. requirements.txt
- **Проблема**: Зависимость `python-docx` была записана с пробелами между буквами (`p y t h o n - d o c x`), что делало установку невозможной
- **Решение**: Исправлено на `python-docx`
- **Дополнительно**: Добавлена зависимость `kaleido` для генерации изображений графиков в отчетах
- **Файл**: requirements.txt

#### 2. Дублирование функции calculate_geometry_ibeam
- **Проблема**: Функция `calculate_geometry_ibeam` была определена дважды в файле structural.py (строки 3-37 и 93-145), что приводило к перезаписи первой версии
- **Решение**: Удалена первая (устаревшая) версия функции, оставлена только полная реализация
- **Файл**: src/structural.py:3-40

#### 3. Использование importlib.reload() в продакшене
- **Проблема**: Вызовы `importlib.reload()` для всех модулей (structural, data, thermal, etc.) использовались в продакшен-коде, что является плохой практикой
- **Решение**: Удалены все вызовы `importlib.reload()` и импорт `importlib`
- **Файл**: app.py:5, 19-25

### Добавлено

#### 4. Модуль валидации входных данных
- **Создан**: src/validation.py (300+ строк)
- **Функциональность**:
  - Класс `ValidationError` для специфичных ошибок валидации
  - Функции валидации для каждого типа сечения:
    - `validate_ibeam_geometry()` - двутавр
    - `validate_channel_geometry()` - швеллер
    - `validate_rect_tube_geometry()` - прямоугольная труба
    - `validate_circ_tube_geometry()` - круглая труба
    - `validate_angle_geometry()` - уголок
  - Функции валидации нагрузок:
    - `validate_load()` - продольная нагрузка
    - `validate_bending_load()` - изгиб и поперечная сила
  - Функции валидации материала и других параметров:
    - `validate_material()` - марка стали, Ry, E
    - `validate_geometric_length()` - длина и коэффициент μ
  - Комплексная функция `validate_all_inputs()` для полной проверки всех данных
- **Проверки**:
  - Положительность всех размеров
  - Физическая корректность (например, толщина стенки < ширины полки)
  - Разумные диапазоны значений (например, высота 10-2000 мм)
  - Корректность марки стали из списка допустимых

#### 5. Интеграция валидации в приложение
- **Изменено**: app.py
- **Добавлен импорт**: `from src.validation import ValidationError, validate_all_inputs`
- **Добавлен блок валидации** (app.py:336-369):
  - Валидация выполняется перед всеми расчетами
  - При ошибке валидации пользователь получает понятное сообщение
  - Расчеты не выполняются при некорректных данных
  - Обработка исключений с выводом в UI

#### 6. .gitignore
- **Создан**: .gitignore (150+ строк)
- **Включает**:
  - Python артефакты (__pycache__, *.pyc, *.pyo)
  - Виртуальные окружения (venv/, .venv/, env/)
  - IDE конфигурации (.vscode/, .idea/)
  - Тесты и покрытие (.pytest_cache/, .coverage)
  - Streamlit конфигурация (.streamlit/)
  - OS файлы (.DS_Store, Thumbs.db)
  - Сгенерированные отчеты (*.docx)
  - Временные файлы (*.tmp, *.bak)

#### 7. README.md
- **Создан**: README.md (400+ строк)
- **Разделы**:
  - Описание проекта и возможностей
  - Нормативные документы (СП 16.13330, СП 2.13130, ГОСТ)
  - Инструкции по установке (Windows/Linux/macOS)
  - Руководство по запуску
  - Структура проекта с описанием модулей
  - Подробное руководство пользователя
  - Примеры расчетов
  - Описание методики расчета
  - Известные ограничения
  - Раздел "Устранение неполадок"
  - История изменений

#### 8. CHANGELOG.md
- **Создан**: CHANGELOG.md (этот файл)
- **Назначение**: Документирование всех изменений в проекте по версиям

### Улучшено

#### 9. Обработка ошибок импорта
- **Изменено**: app.py:19
- **Было**: `except ImportError:`
- **Стало**: `except ImportError as e:` с выводом сообщения в UI
- **Результат**: Пользователь видит конкретную ошибку при проблемах с импортом модулей

### Статистика изменений

- **Файлов изменено**: 3 (requirements.txt, app.py, src/structural.py)
- **Файлов создано**: 4 (.gitignore, README.md, CHANGELOG.md, src/validation.py)
- **Строк кода добавлено**: ~850+
- **Строк кода удалено**: ~50
- **Критических багов исправлено**: 3
- **Новых функций добавлено**: 12

### Следующие шаги (не включены в эту версию)

Следующие улучшения рекомендованы для будущих версий:

**Высокий приоритет:**
1. Написание unit-тестов для модулей src/
2. Рефакторинг main() в app.py на отдельные функции
3. Добавление системы логирования

**Средний приоритет:**
4. Создание config.py для централизации констант
5. Добавление кэширования с помощью @st.cache_data
6. Расширенная обработка ошибок в расчетных модулях

**Низкий приоритет:**
7. Настройка CI/CD (GitHub Actions)
8. Оптимизация производительности теплотехнических расчетов
9. Добавление экспорта в PDF

### Обратная совместимость

Все изменения обратно совместимы с предыдущими версиями:
- API расчетных функций не изменен
- Структура входных/выходных данных сохранена
- Существующие профили ГОСТ работают без изменений
- Валидация добавлена как дополнительный слой, не ломая существующую логику

### Миграция с версии 0.9.0

Для обновления с предыдущей версии:

1. Обновите зависимости:
```bash
pip install -r requirements.txt
```

2. Перезапустите приложение:
```bash
streamlit run app.py
```

3. Никаких изменений в пользовательских данных не требуется

### Благодарности

- Код ревью и выявление критических ошибок: Claude Code
- Тестирование валидации: в процессе

---

## [0.9.0] - 2025-12-XX

### Добавлено
- Первоначальная версия приложения
- Расчет огнестойкости для 5 типов сечений
- Поддержка 3 типов нагружения
- Генерация DOCX отчетов
- Интерактивные графики Plotly
- База данных профилей ГОСТ

### Известные проблемы
- Ошибка в requirements.txt (python-docx с пробелами)
- Дублирование функции calculate_geometry_ibeam
- Использование importlib.reload() в продакшене
- Отсутствие валидации входных данных
- Отсутствие .gitignore и README.md
