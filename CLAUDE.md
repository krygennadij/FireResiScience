# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Обзор проекта

FireResiScience — веб-приложение на Streamlit для расчета предела огнестойкости стальных строительных конструкций в соответствии с российскими строительными нормами (СП 16.13330.2017, СП 2.13130.2020, ГОСТ 30247, ФЗ-123).

**Язык проекта:** Весь код, комментарии и документация на русском языке.

## Команды для разработки

### Запуск приложения
```bash
streamlit run app.py
```
Приложение будет доступно по адресу `http://localhost:8501`

### Тестирование
```bash
pytest tests/
```

### Проверка кода
```bash
flake8 src/ app.py
```

### Управление зависимостями
```bash
# Установка зависимостей
pip install -r requirements.txt

# Обновление requirements.txt (если добавлены новые зависимости)
pip freeze > requirements.txt
```

## Архитектура приложения

### Основной поток расчета

1. **app.py** — главный файл Streamlit-приложения:
   - Управляет UI и взаимодействием с пользователем
   - Использует кеширование через `src/cache_helpers.py` для оптимизации производительности
   - Собирает входные данные (тип сечения, материал, нагрузки, условия пожара)
   - Вызывает модули расчета и отображает результаты

2. **Модуль прочностного расчета (`src/structural.py`)**:
   - Рассчитывает коэффициент использования сечения γT в зависимости от типа нагружения:
     - Центральное растяжение/сжатие
     - Центральное сжатие с учетом продольного изгиба (гибкость λ, коэффициент φ)
     - Изгиб (с учетом пластического момента сопротивления через коэффициент c1)
     - Поперечная сила (сдвиг)
   - Определяет критическую температуру Tcr по таблице Б.1 (СП 2.13130.2020) через интерполяцию температурных коэффициентов γT

3. **Модуль теплотехнического расчета (`src/thermal.py`)**:
   - Моделирует стандартную температурную кривую пожара: `Tg(τ) = 345·log₁₀(8τ/60 + 1) + 293 K`
   - Рассчитывает обогреваемый периметр П для различных типов сечений (двутавр, швеллер, труба) с учетом схемы обогрева (3 или 4 стороны)
   - Вычисляет приведенную толщину металла: `δnp = A/П`
   - Пошаговое численное моделирование прогрева конструкции (шаг dt = 1 сек) по формуле теплопередачи
   - Определяет время достижения критической температуры Tcr (предел огнестойкости)

4. **Справочные данные (`src/data.py`)**:
   - Температурные коэффициенты снижения прочности γT и модуля упругости γE по ГОСТ/СП
   - Данные разделены по группам прочности стали (обычная: С235-С255, повышенная: С345-С390)

5. **Базы данных профилей:**
   - `src/ibeam_data.py` — двутавры по ГОСТ
   - `src/channel_data.py` — швеллеры (ГОСТ 8240-97)
   - `src/angle_data.py` — уголки равнополочные (ГОСТ 8509-93)
   - `src/pipe_data.py` — трубы круглые (ГОСТ 8732-78) и прямоугольные
   - Каждый модуль содержит словари с геометрическими характеристиками стандартных профилей

6. **Генерация отчетов (`src/report_generator.py`)**:
   - Создает профессиональные отчеты в формате DOCX
   - Форматирование: Times New Roman 12pt, выравнивание по ширине
   - Включает графики Plotly (через kaleido)

7. **Валидация (`src/validation.py`)**:
   - Проверка корректности входных данных
   - Выбрасывает `ValidationError` при некорректных значениях

### Ключевые особенности кода

- **Кеширование:** Активно используется `@st.cache_data` через wrapper-функции в `cache_helpers.py` для ускорения пересчетов при изменении параметров UI
- **Физические константы:** Все константы (плотность стали ρs = 7800 кг/м³, приведенная излучательная способность Spr = 0.563, и т.д.) зашиты в `thermal.py`
- **Единицы измерения:**
  - Геометрия вводится в мм, но внутренние расчеты могут использовать м и мм (важно следить за консистентностью)
  - Температура: Кельвины (K) в расчетах, но отображается и в °C для пользователя
  - Нагрузки: кН, кН·м
- **Нормативная база:** Формулы и коэффициенты взяты из СП 16.13330.2017 и СП 2.13130.2020 (ссылки на конкретные пункты есть в комментариях к коду)

## Важные замечания при разработке

### При добавлении новых типов сечений:
1. Создать модуль данных в `src/` (по аналогии с `ibeam_data.py`)
2. Реализовать функцию расчета геометрии (площадь, моменты инерции, радиусы инерции, моменты сопротивления)
3. Реализовать расчет обогреваемого периметра в `thermal.py`
4. Добавить схему обогрева (изображение) в `assets/`
5. Интегрировать в UI (`app.py`) с соответствующими условиями

### При модификации расчетных модулей:
- Обязательно обновить кеширование в `cache_helpers.py`
- Проверить, что все формулы соответствуют актуальным СП/ГОСТ
- Добавить комментарии со ссылками на пункты нормативных документов
- Обновить примеры в README.md при изменении логики расчета

### Стиль кода:
- Все имена переменных, функций, комментарии — на русском языке (за исключением стандартных Python-конструкций)
- Docstrings на русском в формате Google Style
- Использовать f-строки для форматирования
- PEP 8 для структуры кода (flake8)

### Данные нормативов:
- При обновлении температурных коэффициентов в `data.py` проверить соответствие актуальным версиям СП
- Интерполяция между табличными значениями реализована через `np.interp()`

## Зависимости

Основные библиотеки:
- **streamlit** — фреймворк веб-приложения
- **plotly** — интерактивные графики
- **pandas/numpy** — обработка данных
- **python-docx** — генерация DOCX-отчетов
- **kaleido** — экспорт графиков Plotly в статичные изображения для вставки в DOCX

Версия Python: 3.8+

## Нормативные документы (справочно)

- **СП 16.13330.2017** — расчет прочности стальных конструкций (коэффициенты c1, расчет γT при изгибе/сжатии)
- **СП 2.13130.2020** — огнестойкость конструкций (таблица Б.1 с температурными коэффициентами, методика определения Tcr)
- **ГОСТ 30247** — стандартная температурная кривая пожара
- **ФЗ-123** — требования пожарной безопасности (классы огнестойкости R15, R30, R45, R60 и т.д.)
